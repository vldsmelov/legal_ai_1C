# Legal AI (RU) ‚Äî –ª–æ–∫–∞–ª—å–Ω—ã–π –ò–ò-—é—Ä–∏—Å—Ç

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–≥–æ–≤–æ—Ä–æ–≤ –ø–æ —Ä–æ—Å—Å–∏–π—Å–∫–æ–º—É –ø—Ä–∞–≤—É –ª–æ–∫–∞–ª—å–Ω–æ, –±–µ–∑ –≤—ã—Ö–æ–¥–∞ –≤ —Å–µ—Ç—å.

**–°—Ç–µ–∫:** FastAPI ¬∑ Ollama (LLM: `qwen2.5:7b-instruct`) ¬∑ Qdrant (–≤–µ–∫—Ç–æ—Ä–∞) ¬∑ BGE-M3 (—ç–º–±–µ–¥–¥–µ—Ä) ¬∑ **bge-reranker-v2-m3** (GPU-—Ä–µ—Ä–∞–Ω–∫–µ—Ä).

---

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üîí **–ü–æ–ª–Ω–æ—Å—Ç—å—é –ª–æ–∫–∞–ª—å–Ω–æ**: –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ (—Å –ø—Ä–æ–≥—Ä–µ—Ç—ã–º–∏ –≤–µ—Å–∞–º–∏).
- üß† **RAG** –ø–æ –±–∞–∑–µ –ù–ü–ê –†–§ (—Å—Ç–∞—Ç—å–∏/—á–∞—Å—Ç–∏/–ø—É–Ω–∫—Ç—ã).
- üéØ **–¢–æ—á–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç**: –∫—Ä–æ—Å—Å-—ç–Ω–∫–æ–¥–µ—Ä **bge-reranker-v2-m3** –Ω–∞ GPU.
- ‚úÖ **–°–∫–æ—Ä–∏–Ω–≥ 1‚Äì100** + –≤–µ—Ä–¥–∏–∫—Ç (`green`/`yellow`/`red`) –∏ –∫—Ä–∞—Ç–∫–∏–π —Ñ–æ–∫—É—Å-—Å–≤–æ–¥.
- üß© –ß—ë—Ç–∫–∏–π JSON-–æ—Ç–≤–µ—Ç —Å **issues**, **section_scores** –∏ **sources** (—Ü–∏—Ç–∞—Ç—ã –ù–ü–ê).

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞
```
backend/
‚îú‚îÄ app.py
‚îú‚îÄ app_core/
‚îÇ ‚îú‚îÄ main.py # —Å–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ ‚îú‚îÄ config.py # ENV/–Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ ‚îú‚îÄ types.py # Pydantic-—Å—Ö–µ–º—ã
‚îÇ ‚îú‚îÄ scoring.py # —Ä–∞–∑–¥–µ–ª—ã, —Ä–∞—Å—á—ë—Ç –±–∞–ª–ª–æ–≤, focus
‚îÇ ‚îú‚îÄ utils.py # —É—Ç–∏–ª–∏—Ç—ã (JSON, –∫—ç—à, dedup, id)
‚îÇ ‚îú‚îÄ startup.py # –ª—ë–≥–∫–∏–µ startup-–ø—Ä–æ–≤–µ—Ä–∫–∏
‚îÇ ‚îú‚îÄ llm/ollama.py # –≤—ã–∑–æ–≤—ã Ollama
‚îÇ ‚îú‚îÄ rag/embedder.py # BGE-M3 (GPU/CPU auto)
‚îÇ ‚îú‚îÄ rag/store.py # Qdrant: ingest/search
‚îÇ ‚îú‚îÄ rerank.py # bge-reranker-v2-m3 (GPU)
‚îÇ ‚îî‚îÄ routes/
‚îÇ ‚îú‚îÄ health.py # GET /health
‚îÇ ‚îú‚îÄ ingest.py # POST /rag/ingest(_sample)
‚îÇ ‚îî‚îÄ analyze.py # POST /analyze, /generate
corpus/
‚îî‚îÄ ru_sample.jsonl # –¥–µ–º–æ-–ù–ü–ê
```

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# 1) –ú–æ–¥–µ–ª—å –¥–ª—è Ollama
ollama pull qwen2.5:7b-instruct

# 2) –ü–æ–¥–Ω—è—Ç—å —Å—Ç–µ–∫
docker compose up -d --build

# 3) –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ
curl -s http://localhost:8000/health | jq

# 4) –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–µ–º–æ-–ù–ü–ê
mkdir -p corpus
curl -s -X POST http://localhost:8000/rag/ingest_sample | jq

# 5) –ü—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑
curl -s -X POST http://localhost:8000/analyze \
  -H "Content-Type: application/json" \
  -d '{
    "contract_text": "–î–û–ì–û–í–û–† –£–°–õ–£–ì ... (—Å–º. –ø—Ä–∏–º–µ—Ä—ã –Ω–∏–∂–µ)",
    "jurisdiction": "RU",
    "contract_type": "—É—Å–ª—É–≥–∏",
    "language": "ru",
    "max_tokens": 512
  }' | jq
```

---


## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (ENV)
| –ö–ª—é—á                 | –ó–Ω–∞—á–µ–Ω–∏–µ (–ø–æ —É–º–æ–ª—á.)      | –û–ø–∏—Å–∞–Ω–∏–µ                 |
| -------------------- | ------------------------- | ------------------------ |
| `OLLAMA_BASE_URL`    | `http://ollama:11434`     | –∞–¥—Ä–µ—Å Ollama             |
| `OLLAMA_MODEL`       | `qwen2.5:7b-instruct`     | LLM                      |
| `QDRANT_URL`         | `http://qdrant:6333`      | –∞–¥—Ä–µ—Å Qdrant             |
| `QDRANT_COLLECTION`  | `ru_law_m3`               | –∫–æ–ª–ª–µ–∫—Ü–∏—è                |
| `EMBEDDING_MODEL`    | `BAAI/bge-m3`             | —ç–º–±–µ–¥–¥–µ—Ä                 |
| `EMBED_DEVICE`       | `auto` | `cuda` | `cpu`   | —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –¥–ª—è —ç–º–±–µ–¥–¥–µ—Ä–∞ |
| `RAG_TOP_K`          | `8`                       | –∫–∞–Ω–¥–∏–¥–∞—Ç—ã –¥–æ rerank      |
| `RERANK_ENABLE`      | `1`                       | –≤–∫–ª—é—á–∏—Ç—å —Ä–µ—Ä–∞–Ω–∫–µ—Ä        |
| `RERANKER_MODEL`     | `BAAI/bge-reranker-v2-m3` | –º–æ–¥–µ–ª—å —Ä–µ—Ä–∞–Ω–∫–∞           |
| `RERANK_DEVICE`      | `auto`                    | —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –¥–ª—è —Ä–µ—Ä–∞–Ω–∫–∞   |
| `RERANK_KEEP`        | `5`                       | –æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ rerank    |
| `RERANK_BATCH`       | `16`                      | –±–∞—Ç—á —Å–∫–æ—Ä–∏–Ω–≥–∞            |
| `RERANK_DEBUG`       | `0`                       | –ª–æ–≥ —Å–∫–æ—Ä–∏–Ω–≥–æ–≤            |
| `STARTUP_CHECKS`     | `1`                       | –ª—ë–≥–∫–∏–µ —Å—Ç–∞—Ä—Ç–∞–ø-—á–µ–∫–∏      |
| `SELF_CHECK_TIMEOUT` | `5`                       | —Ç–∞–π–º–∞—É—Ç –ø–∏–Ω–≥–æ–≤           |
| `SELF_CHECK_GEN`     | `0`                       | —Ç–µ—Å—Ç-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞ —Å—Ç–∞—Ä—Ç–µ |
| `STARTUP_CUDA_NAME`  | `0`                       | –ø–µ—á–∞—Ç–∞—Ç—å –∏–º—è GPU         |
| `SCORING_MODE`       | `strict` | `lenient`      | ¬´–º—è–≥–∫–∏–π¬ª —Å–∫–æ—Ä–∏–Ω–≥         |
| `SCORE_GREEN`        | `75`                      | –ø–æ—Ä–æ–≥ –∑–µ–ª—ë–Ω–æ–≥–æ           |
| `SCORE_YELLOW`       | `51`                      | –ø–æ—Ä–æ–≥ –∂—ë–ª—Ç–æ–≥–æ            |

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å HF-–∫—ç—à: .`/.hf_cache:/root/.cache/huggingface` (—Å–º. DEPLOY).

---

## API
`GET /health`

–ö—Ä–∞—Ç–∫–∏–π —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤ (Ollama, Qdrant, –∫–æ–ª–ª–µ–∫—Ü–∏—è, —Ä–µ—Ä–∞–Ω–∫–µ—Ä).

`POST /rag/ingest_sample`

–ì—Ä—É–∑–∏—Ç corpus/ru_sample.jsonl –≤ Qdrant (–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ ID, –±–µ–∑ –¥—É–±–ª–µ–π).

`POST /rag/ingest`

–ò–Ω–≥–µ—Å—Ç –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–≥–æ –º–∞—Å—Å–∏–≤–∞ –ù–ü–ê:

```
{ "items": [ { "act_id": "...", "article": "...", "text": "...", "local_ref": "..." }, ... ] }
```

---

## –°–º–æ—É–∫-–ø—Ä–∏–º–µ—Ä—ã

- –í–∏—Å–∏—Ç `/analyze` –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—ã–∑–æ–≤–µ ‚Äî –Ω–µ –ø—Ä–æ–≥—Ä–µ—Ç —Ä–µ—Ä–∞–Ω–∫–µ—Ä. –ü—Ä–æ–≥—Ä–µ–π—Ç–µ HF-–∫—ç—à (—Å–º. DEPLOY) –∏–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ `RERANK_ENABLE=0`.

- –û—à–∏–±–∫–∞ `vectors|vectors_config` ‚Äî –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤ Qdrant, –≤ –∫–æ–¥–µ –µ—Å—Ç—å try/except. –ü—Ä–∏ —Å–º–µ–Ω–µ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏ –¥—Ä–æ–ø–Ω–∏—Ç–µ –∫–æ–ª–ª–µ–∫—Ü–∏—é –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ.

- –î—É–±–ª–∏ –≤ **sources** ‚Äî –≤ –æ—Ç–≤–µ—Ç–µ –µ—Å—Ç—å **dedup**; –ø—Ä–∏ ingest ID –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ ‚Üí –∞–ø—Å–µ—Ä—Ç.

---
## –õ–∏—Ü–µ–Ω–∑–∏–∏ / –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- BGE (BAAI) ‚Äî —Å–º. –ª–∏—Ü–µ–Ω–∑–∏—é BAAI. Qdrant ‚Äî Apache-2.0.

- –î–∞–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç ‚Äî –ø—Ä–∏–º–µ—Ä –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –≤–∞—à–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏.